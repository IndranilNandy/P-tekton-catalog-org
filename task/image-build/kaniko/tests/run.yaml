apiVersion: tekton.dev/v1beta1
kind: PipelineRun
metadata:
  generateName: ci-pipelinerun-kaniko-
spec:
  serviceAccountName: test-service-account
  podTemplate:
    securityContext:
      fsGroup: 65532

  params:
    # For git-clone task
    - name: repo-url
      value: git@github.com:IndranilNandy/demo-app-to-test-pipeline
    - name: branch
      value: master

    # # For gradle task
    # - name: gradle-image
    #   value: gradle:8.7.0-jdk17
    # - name: project-dir
    #   value: .
    # - name: tasks
    #   value:
    #     - build
    #     - publish
    #     # - --status
    #     # no improvement with --no-daemon; also gradle now doesn't suggest to disable daemong in CI
    #     # - --no-daemon

    # # For kaniko task
    # - name: app-image
    #   value: devbox6:8097/indranilnandy/appdemo2
    # - name: builder-image
    #   value: gcr.io/kaniko-project/executor:v1.23.1@sha256:7914350eda14b43f3dcc6925afca88d6b7ba5dff13d221bb70ef44d4da73a1e8
    # - name: dockerfile
    #   value: ./docker/copy_build_binary_from_ws.Dockerfile
    # - name: context
    #   value: .
    # - name: extra-args
    #   value:
    #     - --build-arg
    #     - APPLICATION_NAME=com.example.demo.DemoApplication
    #     - --build-arg
    #     - JAR_FILE=*-SNAPSHOT.jar
    #     - --build-arg
    #     - APP_SERVICE=app-service
    #     - --cache=true
    #     - --insecure
    #     - --cache-copy-layers
    #     # --cache-run-layers: default=true
    #     - --cache-run-layers
    # - name: kaniko-cachedir
    #   value: /cache

  workspaces:
    - name: codebase
      persistentVolumeClaim:
        claimName: source-pvc

    # - name: ssh-directory
    #   secret:
    #     secretName: git-creds-ssh-secret-3

    - name: docker-credentials
      secret:
        secretName: test-docker-credentials

  pipelineRef:
    name: ci-pipeline-kaniko